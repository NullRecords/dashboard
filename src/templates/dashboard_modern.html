<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R0-GR Personal Assistant</title>
    <link rel="icon" href="/assets/images/forge-logo.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-900 text-gray-100 h-full">
    <div id="app-bg" class="fixed inset-0 -z-10 bg-cover bg-center opacity-25"></div>
    <!-- Main Container -->
    <div class="flex h-full">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-gray-800 border-r border-gray-700 overflow-y-auto">
            <div class="p-6 border-b border-gray-700 space-y-3">
                <img src="/assets/images/rogr.gif" alt="Roger" class="w-full h-auto rounded-lg border border-purple-500 object-cover"/>
                <div class="text-xl font-bold text-purple-300">R0-GR</div>
                <div class="flex gap-2">
                    <button onclick="toggleWakeWord()" class="px-3 py-2 bg-purple-700 hover:bg-purple-600 rounded text-xs">üé§ Listen</button>
                    <button onclick="promptSpeak()" class="px-3 py-2 bg-purple-600 hover:bg-purple-500 rounded text-xs">üí¨ Ask</button>
                </div>
                <a href="/assistant" class="block text-xs text-purple-400 hover:text-purple-300 underline">Open R0-GR Assistant</a>
            </div>
            <nav class="space-y-2 px-4 py-4">
                <button onclick="showSection('overview')" class="nav-link w-full text-left px-4 py-3 rounded-lg bg-gray-700 text-white transition-colors hover:bg-gray-600">
                    <i class="fas fa-home mr-2"></i>Overview
                </button>
                <button onclick="showSection('weather')" class="nav-link w-full text-left px-4 py-3 rounded-lg text-gray-300 transition-colors hover:bg-gray-700">
                    <i class="fas fa-cloud-sun mr-2"></i>Weather
                </button>
                <button onclick="showSection('news')" class="nav-link w-full text-left px-4 py-3 rounded-lg text-gray-300 transition-colors hover:bg-gray-700">
                    <i class="fas fa-newspaper mr-2"></i>News
                </button>
                <button onclick="showSection('tasks')" class="nav-link w-full text-left px-4 py-3 rounded-lg text-gray-300 transition-colors hover:bg-gray-700">
                    <i class="fas fa-tasks mr-2"></i>Tasks
                </button>
                <button onclick="showSection('calendar')" class="nav-link w-full text-left px-4 py-3 rounded-lg text-gray-300 transition-colors hover:bg-gray-700">
                    <i class="fas fa-calendar mr-2"></i>Calendar
                </button>
                <button onclick="showSection('settings')" class="nav-link w-full text-left px-4 py-3 rounded-lg text-gray-300 transition-colors hover:bg-gray-700">
                    <i class="fas fa-cog mr-2"></i>Settings
                </button>
                <a href="/assistant" class="nav-link w-full text-left px-4 py-3 rounded-lg text-gray-300 transition-colors hover:bg-gray-700 block">
                    <i class="fas fa-robot mr-2"></i>Roger Assistant
                </a>
                <button onclick="openVoiceSettings()" class="nav-link w-full text-left px-4 py-3 rounded-lg text-gray-300 transition-colors hover:bg-gray-700">
                    <i class="fas fa-microphone mr-2"></i>Voice Settings
                </button>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto">
            <div class="sticky top-0 z-10 backdrop-blur bg-gray-800/60 border-b border-gray-700">
                <div class="px-6 py-3 flex items-center justify-between">
                    <div class="text-xl font-bold text-white">Dashboard</div>
                    <div class="flex items-center gap-2 text-sm">
                        <span class="text-gray-300">Background:</span>
                        <select id="bg-select" class="px-2 py-1 bg-gray-900 border border-gray-700 rounded text-sm text-gray-200">
                            <option value="bg1">Background 1</option>
                            <option value="bg2">Background 2</option>
                            <option value="bg3">Background 3</option>
                        </select>
                        <button id="bg-prev" class="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded" title="Previous">‚ü®</button>
                        <button id="bg-next" class="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded" title="Next">‚ü©</button>
                        <input id="bg-url" type="url" placeholder="Paste image URL" class="hidden md:block w-64 px-2 py-1 bg-gray-900 border border-gray-700 rounded text-sm text-gray-200"/>
                        <button id="bg-url-set" class="hidden md:block px-2 py-1 bg-indigo-600 hover:bg-indigo-500 rounded">Set URL</button>
                    </div>
                </div>
            </div>
            <!-- Overview Section -->
            <section id="section-overview" class="section-content p-8 space-y-8">
                <!-- Top Focus: Weather + Garfield -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Weather Widget (Large) -->
                    <div class="bg-gray-800 rounded-lg border border-cyan-700 p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-2xl font-bold text-cyan-300">üå°Ô∏è Weather</h3>
                            <div class="flex gap-2">
                                <button onclick="useCurrentLocation()" class="px-3 py-2 bg-cyan-700 hover:bg-cyan-600 rounded text-xs">Use Current</button>
                            </div>
                        </div>
                        <div class="flex gap-3 mb-3">
                            <input id="weather-search-input" type="text" placeholder="Search city or place..." class="flex-1 px-3 py-2 bg-gray-900 border border-gray-700 rounded text-sm text-gray-200 placeholder-gray-500">
                            <button onclick="searchWeather()" class="px-3 py-2 bg-cyan-700 hover:bg-cyan-600 rounded text-sm">Search</button>
                        </div>
                        <div id="weather-search-results" class="mb-3 text-sm text-gray-400"></div>
                        <div class="mb-3">
                            <div class="text-xs text-gray-400 mb-2">Quick picks:</div>
                            <div class="flex flex-wrap gap-2">
                                <button class="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs" onclick="selectWeatherLocation(45.5152,-122.6784,'Portland, OR')">Portland, OR</button>
                                <button class="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs" onclick="selectWeatherLocation(51.5072,-0.1276,'London, UK')">London</button>
                                <button class="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs" onclick="selectWeatherLocation(35.6762,139.6503,'Tokyo, JP')">Tokyo</button>
                                <button class="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs" onclick="selectWeatherLocation(-33.8688,151.2093,'Sydney, AU')">Sydney</button>
                                <button class="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs" onclick="selectWeatherLocation(48.8566,2.3522,'Paris, FR')">Paris</button>
                                <button class="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs" onclick="selectWeatherLocation(40.7128,-74.0060,'New York, US')">New York</button>
                            </div>
                        </div>
                        <div id="weather-display" class="text-gray-200">Loading...</div>
                        <div id="weather-forecast" class="mt-4 grid grid-cols-2 md:grid-cols-5 gap-2"></div>
                        <div id="weather-alerts" class="mt-4"></div>
                    </div>

                    <!-- Garfield (Large) -->
                    <div class="bg-gray-800 rounded-lg border border-orange-600 p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-2xl font-bold text-orange-300">üìö Comics</h3>
                            <select id="comic-select" class="px-3 py-2 bg-gray-900 border border-gray-700 rounded text-sm text-gray-200">
                                <option value="garfield">Garfield</option>
                                <option value="calvin">Calvin & Hobbes</option>
                                <option value="peanuts">Peanuts</option>
                                <option value="favorites">Favorites</option>
                            </select>
                        </div>
                        <div id="garfield" class="text-sm text-gray-300 min-h-64">Loading...</div>
                        <div class="flex gap-2 mt-4">
                            <button onclick="reloadComic()" class="px-3 py-2 bg-orange-600 hover:bg-orange-700 rounded text-sm">Reload</button>
                            <button onclick="showComicsArchive()" class="px-3 py-2 bg-orange-700 hover:bg-orange-800 rounded text-sm">üìö Archive</button>
                        </div>
                    </div>
                </div>

                <!-- Jokes & Quote -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-800 rounded-lg border border-purple-600 p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-purple-300">üòÑ Jokes</h3>
                            <button onclick="readJokes()" class="px-3 py-1 bg-purple-600 hover:bg-purple-700 rounded text-xs">üîä Read</button>
                        </div>
                        <div id="jokes" class="text-sm text-gray-300">Loading...</div>
                    </div>
                    <div class="bg-gray-800 rounded-lg border border-indigo-600 p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-indigo-300">‚ú® Quote</h3>
                            <button onclick="readQuote()" class="px-3 py-1 bg-indigo-600 hover:bg-indigo-700 rounded text-xs">üîä Read</button>
                        </div>
                        <div id="quote" class="text-sm text-gray-300 italic">Loading...</div>
                    </div>
                </div>

                <!-- eBay Auctions Section -->
                <div class="bg-gray-800 rounded-lg border border-yellow-600 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold text-yellow-300">
                            <i class="fas fa-gavel mr-2"></i>eBay Auction Finds
                        </h3>
                        <button onclick="loadEbayAuctions()" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-sm">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh
                        </button>
                    </div>
                    <p class="text-sm text-gray-400 mb-4">üíª Retro laptops & gaming systems ending soon with great prices</p>
                    <div id="ebay-auctions-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="text-gray-400 text-center py-8 col-span-full">Loading retro tech auctions...</div>
                    </div>
                </div>

                <!-- Calm Radar / Anxiety Feed -->
                    

                <!-- Roger Home Content -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                        <h3 class="text-lg font-semibold text-gray-300 mb-3">üîß Parts Search</h3>
                        <div id="parts" class="text-sm text-gray-400">Loading...</div>
                    </div>
                    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                        <h3 class="text-lg font-semibold text-gray-300 mb-3">üìú History Fact</h3>
                        <div id="history" class="text-sm text-gray-400">Loading...</div>
                    </div>
                    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                        <h3 class="text-lg font-semibold text-gray-300 mb-3">‚≠ê Star Wars</h3>
                        <div id="starwars" class="text-sm text-gray-400">Loading...</div>
                    </div>
                    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                        <h3 class="text-lg font-semibold text-gray-300 mb-3">üöÄ Communities</h3>
                        <div id="communities" class="text-sm text-gray-400">Loading...</div>
                    </div>
                    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-semibold text-gray-300">ü§ñ Roger Quotes</h3>
                            <button onclick="readRogerQuote()" class="px-3 py-1 bg-purple-600 hover:bg-purple-700 rounded text-xs">üîä Read</button>
                        </div>
                        <div id="roger-quotes" class="text-sm text-gray-400">Loading...</div>
                    </div>
                </div>
            </section>

            <!-- Tasks Section -->
            <section id="section-tasks" class="section-content hidden p-8">
                <div class="mb-4">
                    <div class="text-3xl font-extrabold text-white drop-shadow">Tasks</div>
                    <div class="text-xs text-gray-300">Smart tasks from calendar and email</div>
                </div>
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold">Tasks</h2>
                        <div class="flex gap-2">
                            <button onclick="generateSmartTasks(true)" class="px-3 py-2 bg-blue-700 hover:bg-blue-600 rounded text-sm">Generate Smart Tasks</button>
                            <label class="flex items-center gap-2 text-xs text-gray-300">
                                <input id="include-email" type="checkbox" class="accent-blue-500"> Include Email
                            </label>
                        </div>
                    </div>
                    <div id="tasks-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="text-gray-400 col-span-full text-center py-8">Loading tasks...</div>
                    </div>
                </div>
            </section>

            <!-- Weather Section -->
            <section id="section-weather" class="section-content hidden p-8">
                <div class="mb-4">
                    <div class="text-3xl font-extrabold text-white drop-shadow">Weather</div>
                    <div class="text-xs text-gray-300">Local station data, conditions, forecast and alerts</div>
                </div>
                
                <!-- Local Weather Station (Ambient Weather) -->
                <div id="ambient-weather-section" class="bg-gray-800 rounded-lg border border-green-600 p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-2xl font-bold text-green-300">üè† Local Weather Station</h3>
                        <button onclick="loadAmbientWeather()" class="px-3 py-2 bg-green-700 hover:bg-green-600 rounded text-xs">Refresh</button>
                    </div>
                    <div id="ambient-weather-display" class="text-gray-200">Loading local station data...</div>
                </div>
                
                <!-- General Weather -->
                <div class="bg-gray-800 rounded-lg border border-cyan-700 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-2xl font-bold text-cyan-300">üå°Ô∏è Weather</h3>
                        <div class="flex gap-2">
                            <button onclick="useCurrentLocation()" class="px-3 py-2 bg-cyan-700 hover:bg-cyan-600 rounded text-xs">Use Current</button>
                        </div>
                    </div>
                    <div class="flex gap-3 mb-3">
                        <input id="weather-search-input-2" type="text" placeholder="Search city or place..." class="flex-1 px-3 py-2 bg-gray-900 border border-gray-700 rounded text-sm text-gray-200 placeholder-gray-500">
                        <button onclick="searchWeatherTo('weather-search-input-2','weather-search-results-2')" class="px-3 py-2 bg-cyan-700 hover:bg-cyan-600 rounded text-sm">Search</button>
                    </div>
                    <div id="weather-search-results-2" class="mb-3 text-sm text-gray-400"></div>
                    <div id="weather-display-2" class="text-gray-200">Loading...</div>
                    <div id="weather-forecast-2" class="mt-4 grid grid-cols-2 md:grid-cols-5 gap-2"></div>
                    <div id="weather-alerts-2" class="mt-4"></div>
                </div>
            </section>

            <!-- Calendar Section -->
            <section id="section-calendar" class="section-content hidden p-8">
                <div class="mb-4">
                    <div class="text-3xl font-extrabold text-white drop-shadow">Calendar</div>
                    <div class="text-xs text-gray-300">Family schedule and upcoming events</div>
                </div>
                <div class="bg-gray-800 rounded-lg border border-green-600 p-6">
                    <h3 class="text-2xl font-bold text-green-300 mb-4">
                        <i class="fas fa-calendar-alt mr-2"></i>Calendar
                    </h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-green-200 mb-3">Primary Calendar</h4>
                            <div id="calendar-primary" class="bg-gray-900 rounded border border-green-700 p-4 min-h-80 text-sm text-gray-400">Loading...</div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-blue-200 mb-3">Family Calendar (iCloud)</h4>
                            <div id="calendar-family" class="bg-gray-900 rounded border border-blue-700 p-4 min-h-80 text-sm text-gray-400">Loading...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- News Section -->
            <section id="section-news" class="section-content hidden p-8">
                <div class="mb-4">
                    <div class="text-3xl font-extrabold text-white drop-shadow">News</div>
                    <div class="text-xs text-gray-300">Curated updates and supportive tips</div>
                </div>
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold">News</h2>
                        <div class="flex gap-2">
                            <select id="news-filter" class="px-3 py-2 bg-gray-900 border border-gray-700 rounded text-sm text-gray-200">
                                <option value="all">All</option>
                                <option value="oregon">Oregon</option>
                                <option value="starwars">Star Wars</option>
                                <option value="startrek">Star Trek</option>
                            </select>
                            <button onclick="loadNews()" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm">Refresh</button>
                        </div>
                    </div>
                    <div id="news-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="text-gray-400 col-span-full text-center py-8">Loading news...</div>
                    </div>
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-emerald-300 mb-2"><i class="fas fa-heart mr-2"></i>Calm Tips</h3>
                        <div id="calm-tips" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="text-gray-400 col-span-full text-center py-6">Loading calm tips...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="section-settings" class="section-content hidden p-8">
                <div class="mb-4">
                    <div class="text-3xl font-extrabold text-white drop-shadow">Settings</div>
                    <div class="text-xs text-gray-300">Personalize your dashboard</div>
                </div>
                <div id="settings-container" class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                    <h2 class="text-2xl font-bold mb-4">Settings</h2>
                    <div class="text-gray-400">Loading settings...</div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal Container -->
    <div id="modal-container"></div>

    <!-- Voice Settings Modal -->
    <div id="voice-settings-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
        <div class="bg-gray-800 rounded-lg border border-gray-700 p-8 max-w-2xl w-full max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-purple-300">ü§ñ Voice Settings</h2>
                <button onclick="closeVoiceSettings()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="voice-settings-content" class="space-y-6">Loading...</div>
        </div>
    </div>

    <!-- Garfield Archive Modal -->
    <div id="garfield-archive-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
        <div class="bg-gray-800 rounded-lg border border-orange-600 p-8 max-w-4xl w-full max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-orange-300"><i class="fas fa-archive mr-2"></i>Garfield Archive</h2>
                <button onclick="closeGarfieldArchive()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="garfield-archive-content" class="grid grid-cols-1 md:grid-cols-2 gap-6">Loading...</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/dashboard.js?v=6"></script>
    <script src="/static/leads_modern.js?v=6"></script>
    <script src="/static/trust_layer_ui.js?v=2"></script>
    <script src="/static/provider_manager.js?v=2"></script>

    <script>
        // Backgrounds
        const BACKGROUNDS = [
            { key: 'bg1', type: 'image', value: '/static/backgrounds/photo-1472457897821-70d3819a0e24.avif' },
            { key: 'bg2', type: 'image', value: '/static/backgrounds/photo-1618336753974-aae8e04506aa.avif' },
            { key: 'bg3', type: 'image', value: '/static/backgrounds/premium_photo-1721254102757-6ac520920e0a.avif' }
        ];

        function applyBackground(bg) {
            const layer = document.getElementById('app-bg');
            if (!layer) return;
            if (bg.type === 'gradient') {
                layer.style.backgroundImage = bg.value;
            } else {
                layer.style.backgroundImage = `url('${bg.value}')`;
            }
        }

        function setBackgroundByKey(key) {
            const idx = BACKGROUNDS.findIndex(b => b.key === key);
            const bg = idx >= 0 ? BACKGROUNDS[idx] : BACKGROUNDS[0];
            try { localStorage.setItem('dashboard_bg_key', bg.key); } catch {}
            const select = document.getElementById('bg-select');
            if (select) select.value = bg.key;
            applyBackground(bg);
        }

        function cycleBackground(dir = 1) {
            const current = (localStorage.getItem('dashboard_bg_key') || BACKGROUNDS[0].key);
            const idx = BACKGROUNDS.findIndex(b => b.key === current);
            const next = (idx + dir + BACKGROUNDS.length) % BACKGROUNDS.length;
            setBackgroundByKey(BACKGROUNDS[next].key);
        }

        function setBackgroundUrl(url) {
            if (!url) return;
            const bg = { key: 'custom-url', type: 'image', value: url };
            try { localStorage.setItem('dashboard_bg_custom', url); localStorage.setItem('dashboard_bg_key', bg.key); } catch {}
            const select = document.getElementById('bg-select');
            if (select) select.value = 'custom-url';
            const layer = document.getElementById('app-bg');
            if (layer) layer.style.backgroundImage = `url('${url}')`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const select = document.getElementById('bg-select');
            const prev = document.getElementById('bg-prev');
            const next = document.getElementById('bg-next');
            const urlInput = document.getElementById('bg-url');
            const urlBtn = document.getElementById('bg-url-set');
            // Inject custom-url option if present
            try {
                const custom = localStorage.getItem('dashboard_bg_custom');
                if (custom && select && ![...select.options].some(o => o.value === 'custom-url')) {
                    const opt = document.createElement('option');
                    opt.value = 'custom-url'; opt.textContent = 'Custom URL';
                    select.appendChild(opt);
                }
            } catch {}
            if (select) {
                select.addEventListener('change', () => {
                    const v = select.value;
                    if (v === 'custom-url') {
                        const saved = localStorage.getItem('dashboard_bg_custom');
                        if (saved) setBackgroundUrl(saved);
                    } else {
                        setBackgroundByKey(v);
                    }
                });
            }
            if (prev) prev.addEventListener('click', () => cycleBackground(-1));
            if (next) next.addEventListener('click', () => cycleBackground(1));
            if (urlBtn) urlBtn.addEventListener('click', () => setBackgroundUrl(urlInput.value.trim()));
            // Initialize
            const stored = localStorage.getItem('dashboard_bg_key');
            if (stored === 'custom-url') {
                const cu = localStorage.getItem('dashboard_bg_custom');
                if (cu) setBackgroundUrl(cu); else setBackgroundByKey('gradient-ocean');
            } else if (stored) {
                setBackgroundByKey(stored);
            } else {
                setBackgroundByKey('gradient-ocean');
            }
        });

        // Navigation
        function showSection(sectionName) {
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('bg-gray-700', 'text-white');
                link.classList.add('text-gray-300');
            });

            const section = document.getElementById(`section-${sectionName}`);
            if (section) {
                section.classList.remove('hidden');
                // Load section-specific data
                if (sectionName === 'calendar') {
                    loadFamilyCalendar();
                } else if (sectionName === 'weather') {
                    // Load local weather station first
                    loadAmbientWeather();
                    // Then load general weather
                    try {
                        const saved = JSON.parse(localStorage.getItem('weather_selected') || 'null');
                        if (saved && saved.lat && saved.lon) {
                            loadWeather(saved.lat, saved.lon, saved.name || null);
                            // mirror to weather section elements
                            mirrorWeatherToSection();
                        } else {
                            useCurrentLocation();
                            mirrorWeatherToSection();
                        }
                    } catch {
                        loadWeather();
                        mirrorWeatherToSection();
                    }
                } else if (sectionName === 'news') {
                    loadNews();
                    loadCalmTips();
                } else if (sectionName === 'settings') {
                    loadSettings();
                } else if (sectionName === 'overview') {
                    // Ensure overview content is fresh when switching back
                    reloadComic();
                    loadJokes();
                    loadQuote();
                    loadEbayAuctions();
                }
                if (typeof event !== 'undefined' && event && event.target) {
                    const navLink = event.target.closest('.nav-link');
                    if (navLink) {
                        navLink.classList.add('bg-gray-700', 'text-white');
                        navLink.classList.remove('text-gray-300');
                    }
                }
            }
        }

        function mirrorWeatherToSection() {
            // Copy overview weather content to standalone section
            const srcDisplay = document.getElementById('weather-display');
            const srcForecast = document.getElementById('weather-forecast');
            const srcAlerts = document.getElementById('weather-alerts');
            const dstDisplay = document.getElementById('weather-display-2');
            const dstForecast = document.getElementById('weather-forecast-2');
            const dstAlerts = document.getElementById('weather-alerts-2');
            if (srcDisplay && dstDisplay) dstDisplay.innerHTML = srcDisplay.innerHTML;
            if (srcForecast && dstForecast) dstForecast.innerHTML = srcForecast.innerHTML;
            if (srcAlerts && dstAlerts) dstAlerts.innerHTML = srcAlerts.innerHTML;
        }

        // Roger voice controls
        async function toggleWakeWord() {
            try {
                const current = await (await fetch('/api/voice/settings')).json();
                const v = current.voice || {};
                const newVal = !v.wake_word_enabled;
                await fetch('/api/voice/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ wake_word_enabled: newVal })
                });
                alert(newVal ? 'Roger is now listening for wake word.' : 'Roger wake word listening disabled.');
            } catch (e) {
                console.error('Wake word toggle failed', e);
            }
        }

        async function promptSpeak() {
            const text = prompt('Ask Roger:');
            if (!text) return;
            try {
                const r = await fetch('/api/voice/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text, style: 'droid', signature: false })
                });
                const data = await r.json();
                if (!data.success) console.warn('Voice speak failed', data);
            } catch (e) {
                console.error('Speak error', e);
            }
        }

        // Voice Settings
        function openVoiceSettings() {
            document.getElementById('voice-settings-modal').classList.remove('hidden');
            loadVoiceSettings();
        }

        function closeVoiceSettings() {
            document.getElementById('voice-settings-modal').classList.add('hidden');
        }

        async function loadVoiceSettings() {
            const content = document.getElementById('voice-settings-content');
            try {
                const resp = await fetch('/api/voice/settings');
                const data = await resp.json();
                if (data && data.voice) {
                    const s = data.voice;
                    content.innerHTML = `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Voice Style</label>
                                <select id="voice-style" onchange="updateVoiceSetting('style')" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                                    <option value="droid" ${s.default_style === 'droid' ? 'selected' : ''}>ü§ñ Droid (Battle Droid)</option>
                                    <option value="radio" ${s.default_style === 'radio' ? 'selected' : ''}>üìª Radio</option>
                                    <option value="pa_system" ${s.default_style === 'pa_system' ? 'selected' : ''}>üì¢ PA System</option>
                                    <option value="clean" ${s.default_style === 'clean' ? 'selected' : ''}>üîä Clean (No Effects)</option>
                                </select>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="block text-sm font-semibold mb-1">üé¨ Authentic Battle Droid Samples</label>
                                    <p class="text-xs text-gray-400">Use real Star Wars audio for signature phrases</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="use-authentic" ${s.use_authentic_samples !== false ? 'checked' : ''} onchange="updateVoiceSetting('authentic')" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Speed: <span id="speed-value">${(s.speed || 0.75).toFixed(2)}</span>x</label>
                                <input type="range" id="voice-speed" min="0.5" max="1.5" step="0.05" value="${s.speed || 0.75}" oninput="document.getElementById('speed-value').textContent = this.value" onchange="updateVoiceSetting('speed')" class="w-full">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Pitch: <span id="pitch-value">${(s.pitch || 0.85).toFixed(2)}</span>x</label>
                                <input type="range" id="voice-pitch" min="0.5" max="1.5" step="0.05" value="${s.pitch || 0.85}" oninput="document.getElementById('pitch-value').textContent = this.value" onchange="updateVoiceSetting('pitch')" class="w-full">
                            </div>
                            <div class="flex gap-2">
                                <button onclick="saveVoiceSettings()" class="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold">Save Settings</button>
                                <button onclick="testVoice()" id="test-voice-btn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-white font-semibold">üîä Test</button>
                            </div>
                        </div>
                    `;
                }
            } catch (e) {
                console.error('Error loading voice settings:', e);
                content.innerHTML = '<div class="text-red-400">Error loading settings</div>';
            }
        }

        async function updateVoiceSetting(field) {
            const speed = parseFloat(document.getElementById('voice-speed')?.value || 0.75);
            const pitch = parseFloat(document.getElementById('voice-pitch')?.value || 0.85);
            const style = document.getElementById('voice-style')?.value || 'droid';
            const useAuthentic = document.getElementById('use-authentic')?.checked !== false;

            if (field === 'speed') {
                document.getElementById('speed-value').textContent = speed.toFixed(2);
            }
            if (field === 'pitch') {
                document.getElementById('pitch-value').textContent = pitch.toFixed(2);
            }

            try {
                await fetch('/api/voice/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        default_style: style,
                        speed: speed,
                        pitch: pitch,
                        use_authentic_samples: useAuthentic
                    })
                });
            } catch (e) {
                console.error('Error updating voice setting:', e);
            }
        }

        async function saveVoiceSettings() {
            try {
                const style = document.getElementById('voice-style')?.value || 'droid';
                const speed = parseFloat(document.getElementById('voice-speed')?.value || 0.75);
                const pitch = parseFloat(document.getElementById('voice-pitch')?.value || 0.85);
                const useAuthentic = document.getElementById('use-authentic')?.checked !== false;
                
                await fetch('/api/voice/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        default_style: style,
                        speed: speed,
                        pitch: pitch,
                        use_authentic_samples: useAuthentic
                    })
                });
                closeVoiceSettings();
            } catch (e) {
                console.error('Save voice settings error:', e);
                alert('Failed to save settings');
            }
        }

        async function testVoice() {
            const testBtn = document.getElementById('test-voice-btn');
            if (testBtn) testBtn.disabled = true;
            try {
                const r = await fetch('/api/voice/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: 'Roger roger. Voice test complete.', style: 'droid', signature: true })
                });
                const data = await r.json();
                if (!data.success) alert('Voice test failed: ' + (data.error || 'Unknown error'));
            } catch (e) {
                console.error('Voice test error:', e);
            } finally {
                if (testBtn) testBtn.disabled = false;
            }
        }

        // Read functions for voice
        async function readJokes() {
            const jokesEl = document.getElementById('jokes');
            if (!jokesEl) return;
            const text = jokesEl.innerText || 'No jokes loaded';
            try {
                await fetch('/api/voice/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text, style: 'droid', signature: true })
                });
            } catch (e) {
                console.error('Read jokes error:', e);
            }
        }

        async function readQuote() {
            const quoteEl = document.getElementById('quote');
            if (!quoteEl) return;
            const text = quoteEl.innerText || 'No quote loaded';
            try {
                await fetch('/api/voice/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text, style: 'droid', signature: false })
                });
            } catch (e) {
                console.error('Read quote error:', e);
            }
        }

        async function readRogerQuote() {
            const el = document.getElementById('roger-quotes');
            if (!el) return;
            const text = el.innerText || 'No quote loaded';
            try {
                await fetch('/api/voice/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text, style: 'droid', signature: true })
                });
            } catch (e) {
                console.error('Read roger quote error:', e);
            }
        }

        // OAuth Connect Functions
        function connectGoogle() {
            window.open('/auth/google', 'google_oauth', 'width=500,height=600,popup=yes');
        }

        function connectMicrosoft() {
            window.open('/auth/microsoft', 'microsoft_oauth', 'width=500,height=600,popup=yes');
        }

        function connectProton() {
            // Proton uses Bridge - show configuration modal
            alert('Proton Bridge Setup:\n\n1. Install Proton Mail Bridge on your system\n2. Log in to the Bridge application\n3. Configure IMAP/SMTP credentials in credentials.yaml\n\nSee PROVIDER_SETUP.md for detailed instructions.');
        }

        // Settings Page Loader
        async function loadSettings() {
            const container = document.getElementById('settings-container');
            if (!container) return;
            
            try {
                // Fetch voice settings and auth status
                const voiceResp = await fetch('/api/voice/settings');
                const voiceData = await voiceResp.json();
                const v = voiceData.voice || {};
                
                // Check auth status for each provider
                let googleStatus = { authenticated: false };
                let microsoftStatus = { authenticated: false };
                let protonStatus = { authenticated: false };
                
                try {
                    const gResp = await fetch('/api/auth/google/status');
                    googleStatus = await gResp.json();
                } catch (e) { console.log('Google auth check skipped'); }
                
                try {
                    const mResp = await fetch('/api/auth/microsoft/status');
                    microsoftStatus = await mResp.json();
                } catch (e) { console.log('Microsoft auth check skipped'); }
                
                try {
                    const pResp = await fetch('/api/auth/proton/status');
                    protonStatus = await pResp.json();
                } catch (e) { console.log('Proton auth check skipped'); }
                
                // Get saved preferences from localStorage
                const bgKey = localStorage.getItem('dashboard_bg_key') || 'bg1';
                const weatherLoc = JSON.parse(localStorage.getItem('weather_selected') || '{}');
                
                container.innerHTML = `
                    <h2 class="text-2xl font-bold mb-6">Settings</h2>
                    
                    <!-- Connected Accounts -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-purple-300 mb-4"><i class="fas fa-link mr-2"></i>Connected Accounts</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-gray-900 rounded-lg border border-gray-700 p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <img src="https://www.google.com/favicon.ico" class="w-5 h-5" alt="Google">
                                        <span class="font-semibold">Google</span>
                                    </div>
                                    <span class="text-xs ${googleStatus.authenticated ? 'text-green-400' : 'text-gray-500'}">${googleStatus.authenticated ? '‚úì Connected' : 'Not connected'}</span>
                                </div>
                                <p class="text-xs text-gray-500 mb-3">Gmail, Calendar, Drive</p>
                                <button onclick="connectGoogle()" class="w-full px-3 py-2 ${googleStatus.authenticated ? 'bg-green-700 hover:bg-green-600' : 'bg-blue-600 hover:bg-blue-700'} rounded text-sm">
                                    ${googleStatus.authenticated ? '‚úì Reconnect' : 'Connect Google'}
                                </button>
                            </div>
                            <div class="bg-gray-900 rounded-lg border border-gray-700 p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <img src="https://www.microsoft.com/favicon.ico" class="w-5 h-5" alt="Microsoft">
                                        <span class="font-semibold">Microsoft 365</span>
                                    </div>
                                    <span class="text-xs ${microsoftStatus.authenticated ? 'text-green-400' : 'text-gray-500'}">${microsoftStatus.authenticated ? '‚úì Connected' : 'Not connected'}</span>
                                </div>
                                <p class="text-xs text-gray-500 mb-3">Outlook, OneDrive, Teams</p>
                                <button onclick="connectMicrosoft()" class="w-full px-3 py-2 ${microsoftStatus.authenticated ? 'bg-green-700 hover:bg-green-600' : 'bg-blue-600 hover:bg-blue-700'} rounded text-sm">
                                    ${microsoftStatus.authenticated ? '‚úì Reconnect' : 'Connect Microsoft'}
                                </button>
                            </div>
                            <div class="bg-gray-900 rounded-lg border border-gray-700 p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <span class="text-lg">üîí</span>
                                        <span class="font-semibold">Proton</span>
                                    </div>
                                    <span class="text-xs ${protonStatus.authenticated ? 'text-green-400' : 'text-gray-500'}">${protonStatus.authenticated ? '‚úì Connected' : 'Not connected'}</span>
                                </div>
                                <p class="text-xs text-gray-500 mb-3">ProtonMail via Bridge</p>
                                <button onclick="connectProton()" class="w-full px-3 py-2 ${protonStatus.authenticated ? 'bg-green-700 hover:bg-green-600' : 'bg-purple-600 hover:bg-purple-700'} rounded text-sm">
                                    ${protonStatus.authenticated ? '‚úì Reconnect' : 'Connect Proton'}
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Appearance -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-purple-300 mb-4"><i class="fas fa-palette mr-2"></i>Appearance</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-gray-900 rounded-lg border border-gray-700 p-4">
                                <label class="block text-sm font-semibold mb-2">Background Theme</label>
                                <div class="text-sm text-gray-400 mb-2">Current: ${bgKey}</div>
                                <div class="flex gap-2">
                                    <button onclick="setBackgroundByKey('bg1')" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm">Theme 1</button>
                                    <button onclick="setBackgroundByKey('bg2')" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm">Theme 2</button>
                                    <button onclick="setBackgroundByKey('bg3')" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm">Theme 3</button>
                                </div>
                            </div>
                            <div class="bg-gray-900 rounded-lg border border-gray-700 p-4">
                                <label class="block text-sm font-semibold mb-2">Default Weather Location</label>
                                <div class="text-sm text-gray-400">${weatherLoc.name || 'Not set - using current location'}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Voice Settings -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-purple-300 mb-4"><i class="fas fa-microphone mr-2"></i>Voice (Roger)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-gray-900 rounded-lg border border-gray-700 p-4">
                                <label class="block text-sm font-semibold mb-2">Voice Style</label>
                                <select id="settings-voice-style" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 mb-3">
                                    <option value="droid" ${v.default_style === 'droid' ? 'selected' : ''}>ü§ñ Droid (Battle Droid)</option>
                                    <option value="radio" ${v.default_style === 'radio' ? 'selected' : ''}>üìª Radio</option>
                                    <option value="pa_system" ${v.default_style === 'pa_system' ? 'selected' : ''}>üì¢ PA System</option>
                                    <option value="clean" ${v.default_style === 'clean' ? 'selected' : ''}>üîä Clean (No Effects)</option>
                                </select>
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-sm">Authentic Battle Droid Samples</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="settings-authentic" ${v.use_authentic_samples !== false ? 'checked' : ''} class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <span class="text-sm">Random Sarcasm</span>
                                        <div class="text-xs text-gray-500">Roger adds occasional sarcastic comments</div>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="settings-sarcasm" ${v.sarcasm_enabled ? 'checked' : ''} class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                    </label>
                                </div>
                            </div>
                            <div class="bg-gray-900 rounded-lg border border-gray-700 p-4">
                                <label class="block text-sm font-semibold mb-2">Speed: <span id="settings-speed-value">${(v.speed || 0.75).toFixed(2)}</span>x</label>
                                <input type="range" id="settings-voice-speed" min="0.5" max="1.5" step="0.05" value="${v.speed || 0.75}" oninput="document.getElementById('settings-speed-value').textContent = this.value" class="w-full mb-3">
                                <label class="block text-sm font-semibold mb-2">Pitch: <span id="settings-pitch-value">${(v.pitch || 0.85).toFixed(2)}</span>x</label>
                                <input type="range" id="settings-voice-pitch" min="0.5" max="1.5" step="0.05" value="${v.pitch || 0.85}" oninput="document.getElementById('settings-pitch-value').textContent = this.value" class="w-full mb-3">
                                <label class="block text-sm font-semibold mb-2">Sarcasm Chance: <span id="settings-sarcasm-value">${Math.round((v.sarcasm_chance || 0.4) * 100)}</span>%</label>
                                <input type="range" id="settings-sarcasm-chance" min="0" max="100" step="5" value="${Math.round((v.sarcasm_chance || 0.4) * 100)}" oninput="document.getElementById('settings-sarcasm-value').textContent = this.value" class="w-full">
                            </div>
                        </div>
                        <div class="flex gap-2 mt-4">
                            <button onclick="saveSettingsVoice()" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm">Save Voice Settings</button>
                            <button onclick="testVoice()" id="settings-test-voice-btn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm">üîä Test Voice</button>
                        </div>
                    </div>
                    
                    <!-- Data & Privacy -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-purple-300 mb-4"><i class="fas fa-database mr-2"></i>Data & Privacy</h3>
                        <div class="bg-gray-900 rounded-lg border border-gray-700 p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <div class="font-semibold">Clear Local Cache</div>
                                    <div class="text-xs text-gray-500">Remove cached data and preferences</div>
                                </div>
                                <button onclick="if(confirm('Clear all local data?')){localStorage.clear();location.reload();}" class="px-3 py-2 bg-red-700 hover:bg-red-600 rounded text-sm">Clear</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- About -->
                    <div>
                        <h3 class="text-lg font-semibold text-purple-300 mb-4"><i class="fas fa-info-circle mr-2"></i>About</h3>
                        <div class="bg-gray-900 rounded-lg border border-gray-700 p-4">
                            <div class="text-sm text-gray-300">R0-GR Personal Dashboard</div>
                            <div class="text-xs text-gray-500 mt-1">A Buildly Labs project</div>
                            <div class="text-xs text-gray-500 mt-1">Voice: Piper TTS with custom droid effects</div>
                        </div>
                    </div>
                `;
            } catch (e) {
                console.error('Settings load error:', e);
                container.innerHTML = '<div class="text-red-400">Error loading settings</div>';
            }
        }

        async function saveSettingsVoice() {
            try {
                const style = document.getElementById('settings-voice-style')?.value || 'droid';
                const speed = parseFloat(document.getElementById('settings-voice-speed')?.value || 0.75);
                const pitch = parseFloat(document.getElementById('settings-voice-pitch')?.value || 0.85);
                const useAuthentic = document.getElementById('settings-authentic')?.checked !== false;
                const sarcasmEnabled = document.getElementById('settings-sarcasm')?.checked || false;
                const sarcasmChance = (parseInt(document.getElementById('settings-sarcasm-chance')?.value || 40)) / 100;
                
                await fetch('/api/voice/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        default_style: style,
                        speed: speed,
                        pitch: pitch,
                        use_authentic_samples: useAuthentic,
                        sarcasm_enabled: sarcasmEnabled,
                        sarcasm_chance: sarcasmChance
                    })
                });
                alert('Voice settings saved!');
            } catch (e) {
                console.error('Save voice settings error:', e);
                alert('Failed to save settings');
            }
        }

        // Comics
        async function reloadComic() {
            const display = document.getElementById('garfield');
            const sel = document.getElementById('comic-select');
            const choice = sel ? sel.value : 'garfield';
            if (!display) return;
            display.innerHTML = '<div class="animate-pulse text-gray-400">Loading comic...</div>';
            try {
                let url = '';
                if (choice === 'garfield') {
                    url = '/api/comics/garfield/random';
                } else if (choice === 'calvin') {
                    url = '/api/comics/calvin/daily';
                } else if (choice === 'peanuts') {
                    url = '/api/comics/peanuts';
                } else if (choice === 'favorites') {
                    display.innerHTML = '<div class="text-sm text-gray-300">Use the Archive button to browse favorites.</div>';
                    return;
                }
                const resp = await fetch(url);
                const data = await resp.json();
                const comic = data.comic || data;
                const image = comic.image_url || data.image_url;
                const link = (comic.link || data.page_url || '#');
                if (image) {
                    display.innerHTML = `
                        <a href="${link}" target="_blank" class="block">
                            <img src="${image}" alt="Comic" class="w-full rounded-lg border border-orange-600 max-h-64 object-contain bg-gray-900">
                        </a>`;
                } else {
                    display.innerHTML = '<div class="text-gray-400">No comic available.</div>';
                }
            } catch (e) {
                console.error('Comic error:', e);
                display.innerHTML = '<div class="text-red-400">Error loading comic.</div>';
            }
        }

        async function showComicsArchive() {
            const modal = document.getElementById('garfield-archive-modal');
            const content = document.getElementById('garfield-archive-content');
            modal.classList.remove('hidden');
            content.innerHTML = '<div class="col-span-full text-gray-400 text-center py-8">Loading...</div>';
            try {
                const resp = await fetch('/api/comics/favorites');
                const data = await resp.json();
                if (data.success && data.favorites && data.favorites.length > 0) {
                    content.innerHTML = data.favorites.map(comic => `
                        <div class="bg-gray-900 rounded-lg border border-orange-600 overflow-hidden">
                            <a href="${comic.link || '#'}" target="_blank" class="block">
                                <img src="${comic.image_url}" alt="Comic" class="w-full h-40 object-cover">
                            </a>
                            <div class="p-2 text-xs text-orange-300">${comic.date || ''}</div>
                        </div>
                    `).join('');
                } else {
                    content.innerHTML = '<div class="col-span-full text-gray-400 text-center py-8">No favorites yet</div>';
                }
            } catch (e) {
                console.error('Archive error:', e);
            }
        }

        function closeGarfieldArchive() {
            document.getElementById('garfield-archive-modal').classList.add('hidden');
        }

        // eBay Auctions
        async function loadEbayAuctions() {
            const list = document.getElementById('ebay-auctions-list');
            if (!list) return;
            list.innerHTML = '<div class="col-span-full text-gray-400 text-center py-8 animate-pulse">Scanning eBay for deals...</div>';
            try {
                const resp = await fetch('/api/ebay/auctions?category=retro_tech');
                const data = await resp.json();
                console.log('eBay response:', data);
                if (data.success && data.auctions && data.auctions.length > 0) {
                    list.innerHTML = data.auctions.map(auction => `
                        <div class="bg-gray-900 rounded-lg border border-yellow-600 overflow-hidden flex flex-col">
                            <img src="${auction.image_url}" alt="${auction.title}" class="w-full h-40 object-cover">
                            <div class="p-3 flex-1 flex flex-col">
                                <h4 class="font-semibold text-yellow-300 line-clamp-2 text-sm mb-2">${auction.title}</h4>
                                <div class="flex justify-between items-center mb-3 mt-auto">
                                    <span class="text-lg font-bold text-green-300">$${auction.current_price}</span>
                                    <span class="text-xs text-gray-400">${auction.time_left}</span>
                                </div>
                                <a href="${auction.link}" target="_blank" class="block w-full px-3 py-2 bg-yellow-600 hover:bg-yellow-700 rounded text-sm text-center font-semibold">View</a>
                            </div>
                        </div>
                    `).join('');
                } else {
                    list.innerHTML = '<div class="col-span-full text-gray-400 text-center py-8">üîç No auctions found right now. eBay\'s structure may have changed.</div>';
                }
            } catch (e) {
                console.error('eBay error:', e);
                list.innerHTML = '<div class="col-span-full text-red-400 text-center py-8">Error loading auctions</div>';
            }
        }

        // Weather
        async function loadWeather(lat = null, lon = null, name = null) {
            const display = document.getElementById('weather-display');
            const forecastBox = document.getElementById('weather-forecast');
            const alertsBox = document.getElementById('weather-alerts');
            try {
                const qs = new URLSearchParams();
                if (lat !== null && lon !== null) {
                    qs.set('lat', lat);
                    qs.set('lon', lon);
                }
                if (name) qs.set('location', name);
                const resp = await fetch(`/api/weather${qs.toString() ? '?' + qs.toString() : ''}`);
                const data = await resp.json();
                const w = data;
                if (w && (w.temperature || w.description)) {
                    display.innerHTML = `
                        <div class="flex items-start justify-between">
                            <div>
                                <div class="text-5xl font-extrabold text-cyan-300">${w.temperature || ''}</div>
                                <div class="text-sm text-gray-400">${w.description || 'No data'}</div>
                                <div class="text-xs text-gray-500 mt-1">Feels like ${w.feels_like || ''}</div>
                                <div class="text-xs text-gray-500 mt-1">Wind: ${w.wind_speed ?? ''} mph</div>
                                <div class="text-xs text-gray-500 mt-1">Humidity: ${w.humidity ?? ''}%</div>
                                <div class="text-xs text-gray-500 mt-1">Location: ${w.location || (name || 'Unknown')}</div>
                            </div>
                        </div>
                    `;

                    // Forecast
                    if (Array.isArray(w.forecast)) {
                        forecastBox.innerHTML = w.forecast.map(f => `
                            <div class="bg-gray-900 rounded border border-cyan-700 p-2 text-xs text-gray-300">
                                <div class="font-semibold text-cyan-300">${f.day || ''}</div>
                                <div class="text-gray-400">${f.high} / ${f.low}</div>
                                <div class="text-gray-500">${f.condition || ''}</div>
                            </div>
                        `).join('');
                    } else {
                        forecastBox.innerHTML = '';
                    }

                    // Alerts
                    if (Array.isArray(w.alerts) && w.alerts.length) {
                        alertsBox.innerHTML = `
                            <div class="text-sm font-semibold text-red-300 mb-2">Severe Weather Alerts</div>
                            ${w.alerts.map(a => `
                                <div class="bg-gray-900 rounded border border-red-700 p-3 mb-2">
                                    <div class="text-red-300 font-semibold text-sm">${a.event || 'Alert'} (${a.severity || ''})</div>
                                    <div class="text-xs text-gray-400">${a.start || ''} ‚Üí ${a.end || ''}</div>
                                    <div class="text-xs text-gray-300 mt-1">${a.description || ''}</div>
                                    <div class="text-xs text-gray-500 mt-1">Source: ${a.source || ''}</div>
                                </div>
                            `).join('')}
                        `;
                    } else {
                        alertsBox.innerHTML = '';
                    }
                }
            } catch (e) {
                console.error('Weather error:', e);
                display.innerHTML = '<div class="text-sm text-red-400">Error loading weather</div>';
                forecastBox.innerHTML = '';
                alertsBox.innerHTML = '';
            }
        }

        // Ambient Weather (Local Station)
        async function loadAmbientWeather() {
            const display = document.getElementById('ambient-weather-display');
            if (!display) return;
            
            try {
                const resp = await fetch('/api/weather/ambient');
                const data = await resp.json();
                
                if (!data.success) {
                    if (!data.configured) {
                        display.innerHTML = `
                            <div class="bg-gray-900 rounded border border-yellow-600 p-4">
                                <div class="text-yellow-400 font-semibold mb-2">‚ö†Ô∏è Ambient Weather Not Configured</div>
                                <div class="text-sm text-gray-400 mb-3">To connect your local weather station:</div>
                                <ol class="text-xs text-gray-400 list-decimal ml-4 space-y-1">
                                    <li>Go to <a href="https://ambientweather.net/account" target="_blank" class="text-cyan-400 underline">ambientweather.net/account</a></li>
                                    <li>Create an API Key and Application Key</li>
                                    <li>Add both keys to config/credentials.yaml under ambient_weather</li>
                                </ol>
                            </div>
                        `;
                    } else {
                        display.innerHTML = `<div class="text-red-400">${data.error || 'Error loading station data'}</div>`;
                    }
                    return;
                }
                
                const w = data.data;
                const windDir = w.wind_direction_cardinal || '';
                const lastUpdate = w.timestamp ? new Date(w.timestamp).toLocaleTimeString() : '';
                
                display.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Main Temperature -->
                        <div class="bg-gray-900 rounded border border-green-700 p-4">
                            <div class="text-xs text-gray-500 mb-1">Outdoor</div>
                            <div class="text-4xl font-extrabold text-green-300">${w.temperature_display || w.temperature + '¬∞F'}</div>
                            <div class="text-sm text-gray-400">Feels like ${w.feels_like_display || (w.feels_like ? w.feels_like + '¬∞F' : '--')}</div>
                            <div class="text-xs text-gray-500 mt-2">Humidity: ${w.humidity}%</div>
                            <div class="text-xs text-gray-500">Dew Point: ${w.dew_point ? w.dew_point.toFixed(1) + '¬∞F' : '--'}</div>
                        </div>
                        
                        <!-- Indoor -->
                        ${w.temperature_indoor ? `
                        <div class="bg-gray-900 rounded border border-blue-700 p-4">
                            <div class="text-xs text-gray-500 mb-1">Indoor</div>
                            <div class="text-3xl font-bold text-blue-300">${w.temperature_indoor}¬∞F</div>
                            <div class="text-xs text-gray-500 mt-2">Humidity: ${w.humidity_indoor || '--'}%</div>
                        </div>
                        ` : ''}
                        
                        <!-- Wind -->
                        <div class="bg-gray-900 rounded border border-cyan-700 p-4">
                            <div class="text-xs text-gray-500 mb-1">Wind</div>
                            <div class="text-2xl font-bold text-cyan-300">${w.wind_speed || 0} mph ${windDir}</div>
                            <div class="text-xs text-gray-400">Gusts: ${w.wind_gust || 0} mph</div>
                            <div class="text-xs text-gray-500 mt-2">Max Today: ${w.max_daily_gust || 0} mph</div>
                        </div>
                        
                        <!-- Pressure -->
                        <div class="bg-gray-900 rounded border border-purple-700 p-4">
                            <div class="text-xs text-gray-500 mb-1">Pressure</div>
                            <div class="text-xl font-bold text-purple-300">${w.pressure_display || (w.pressure_relative ? w.pressure_relative.toFixed(2) + ' inHg' : '--')}</div>
                        </div>
                        
                        <!-- Rain -->
                        <div class="bg-gray-900 rounded border border-blue-600 p-4">
                            <div class="text-xs text-gray-500 mb-1">Rain</div>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div><span class="text-gray-400">Hourly:</span> <span class="text-blue-300">${w.rain_hourly || 0}"</span></div>
                                <div><span class="text-gray-400">Daily:</span> <span class="text-blue-300">${w.rain_daily || 0}"</span></div>
                                <div><span class="text-gray-400">Weekly:</span> <span class="text-blue-300">${w.rain_weekly || 0}"</span></div>
                                <div><span class="text-gray-400">Monthly:</span> <span class="text-blue-300">${w.rain_monthly || 0}"</span></div>
                            </div>
                        </div>
                        
                        <!-- UV / Solar -->
                        ${w.uv_index !== undefined || w.solar_radiation !== undefined ? `
                        <div class="bg-gray-900 rounded border border-yellow-600 p-4">
                            <div class="text-xs text-gray-500 mb-1">UV / Solar</div>
                            ${w.uv_index !== undefined ? `<div class="text-xl font-bold text-yellow-300">UV ${w.uv_index}</div>` : ''}
                            ${w.solar_radiation !== undefined ? `<div class="text-xs text-gray-400">Solar: ${w.solar_radiation} W/m¬≤</div>` : ''}
                        </div>
                        ` : ''}
                        
                        <!-- Air Quality -->
                        ${w.pm25 !== undefined || w.aqi_pm25 !== undefined ? `
                        <div class="bg-gray-900 rounded border border-orange-600 p-4">
                            <div class="text-xs text-gray-500 mb-1">Air Quality</div>
                            ${w.aqi_pm25 !== undefined ? `<div class="text-xl font-bold text-orange-300">AQI ${w.aqi_pm25}</div>` : ''}
                            ${w.pm25 !== undefined ? `<div class="text-xs text-gray-400">PM2.5: ${w.pm25} ¬µg/m¬≥</div>` : ''}
                        </div>
                        ` : ''}
                    </div>
                    
                    <!-- Station Info -->
                    <div class="mt-4 text-xs text-gray-500 flex justify-between">
                        <span>üì° ${w.station_name || 'Weather Station'} ${w.station_location ? '‚Ä¢ ' + w.station_location : ''}</span>
                        <span>Updated: ${lastUpdate}</span>
                    </div>
                `;
            } catch (e) {
                console.error('Ambient weather error:', e);
                display.innerHTML = '<div class="text-red-400">Error loading local weather station</div>';
            }
        }

        async function searchWeather() {
            const q = document.getElementById('weather-search-input').value.trim();
            const results = document.getElementById('weather-search-results');
            if (!q) { results.innerHTML = ''; return; }
            try {
                const resp = await fetch(`/api/weather/search?q=${encodeURIComponent(q)}`);
                const data = await resp.json();
                if (data.success && Array.isArray(data.results)) {
                    results.innerHTML = data.results.map(r => `
                        <button class="block w-full text-left px-3 py-2 bg-gray-900 hover:bg-gray-700 rounded border border-gray-700 mb-2"
                            onclick="selectWeatherLocation(${r.latitude},${r.longitude},'${r.name}, ${r.country}')">
                            <span class="text-gray-200">${r.name}</span>
                            <span class="text-gray-500">${r.country}</span>
                        </button>
                    `).join('');
                } else {
                    results.innerHTML = '<div class="text-xs text-gray-500">No matches</div>';
                }
            } catch (e) {
                console.error('Weather search error:', e);
            }
        }

        async function searchWeatherTo(inputId, resultsId) {
            const q = document.getElementById(inputId).value.trim();
            const results = document.getElementById(resultsId);
            if (!q) { results.innerHTML = ''; return; }
            try {
                const resp = await fetch(`/api/weather/search?q=${encodeURIComponent(q)}`);
                const data = await resp.json();
                if (data.success && Array.isArray(data.results)) {
                    results.innerHTML = data.results.map(r => `
                        <button class="block w-full text-left px-3 py-2 bg-gray-900 hover:bg-gray-700 rounded border border-gray-700 mb-2"
                            onclick="selectWeatherLocation(${r.latitude},${r.longitude},'${r.name}, ${r.country}')">
                            <span class="text-gray-200">${r.name}</span>
                            <span class="text-gray-500">${r.country}</span>
                        </button>
                    `).join('');
                } else {
                    results.innerHTML = '<div class="text-xs text-gray-500">No matches</div>';
                }
            } catch (e) {
                console.error('Weather search error:', e);
            }
        }

        // News
        async function loadNews() {
            const filterSel = document.getElementById('news-filter');
            const filter = filterSel ? filterSel.value : 'all';
            const list = document.getElementById('news-list');
            try {
                const resp = await fetch(`/api/news?filter=${encodeURIComponent(filter)}`);
                const data = await resp.json();
                const articles = data.articles || [];
                if (!articles.length) {
                    list.innerHTML = '<div class="text-gray-400 col-span-full text-center py-8">No news available</div>';
                    return;
                }
                list.innerHTML = articles.map(a => `
                    <div class="bg-gray-900 rounded border border-gray-700 p-4">
                        <a href="${a.url}" target="_blank" class="text-gray-200 hover:text-white font-semibold">${a.title}</a>
                        <div class="text-xs text-gray-500 mt-1">${a.source || ''} ‚Ä¢ ${a.published_at || ''}</div>
                        <div class="text-sm text-gray-400 mt-2">${a.description || ''}</div>
                        <div class="text-xs text-gray-600 mt-2">${a.category || ''}</div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('News error:', e);
                list.innerHTML = '<div class="text-red-400 col-span-full text-center py-8">Error loading news</div>';
            }
        }

        // Calm Tips (from anxiety feed, supportive only)
        async function loadCalmTips() {
            const tips = document.getElementById('calm-tips');
            try {
                const resp = await fetch('/api/feeds/anxiety');
                const data = await resp.json();
                const articles = (data.articles || []).filter(a => {
                    const t = (a.title || '').toLowerCase();
                    return t.includes('tips') || t.includes('how to') || t.includes('ways to') || t.includes('manage') || t.includes('cope');
                }).slice(0, 6);
                if (!articles.length) {
                    tips.innerHTML = '<div class="text-gray-400 col-span-full text-center py-6">No tips right now</div>';
                    return;
                }
                tips.innerHTML = articles.map(a => `
                    <div class="bg-gray-900 rounded border border-emerald-700 p-3">
                        <a href="${a.link}" target="_blank" class="text-emerald-300 hover:text-emerald-200 font-semibold text-sm line-clamp-2">${a.title}</a>
                        <div class="text-xs text-emerald-200/70 mt-1">${a.date || ''}</div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('Calm tips error:', e);
                tips.innerHTML = '<div class="text-gray-400 col-span-full text-center py-6">Error loading tips</div>';
            }
        }

        // Tasks
        async function loadTasks() {
            const list = document.getElementById('tasks-list');
            try {
                const r = await fetch('/api/tasks');
                const d = await r.json();
                const tasks = d.tasks || [];
                if (!tasks.length) {
                    list.innerHTML = '<div class="text-gray-400 col-span-full text-center py-8">No tasks yet</div>';
                    return;
                }
                list.innerHTML = tasks.map(t => `
                    <div class="bg-gray-900 rounded border border-gray-700 p-4">
                        <div class="font-semibold text-gray-200">${t.title}</div>
                        <div class="text-xs text-gray-500 mt-1">${t.category || ''} ‚Ä¢ ${t.priority || ''}</div>
                        ${t.due_date ? `<div class=\"text-xs text-gray-500 mt-1\">Due: ${t.due_date}</div>` : ''}
                        ${t.source_url ? `<a href=\"${t.source_url}\" target=\"_blank\" class=\"text-xs text-blue-300 hover:underline mt-2 inline-block\">View source</a>` : ''}
                    </div>
                `).join('');
            } catch (e) {
                console.error('Tasks error', e);
                list.innerHTML = '<div class="text-red-400 col-span-full text-center py-8">Error loading tasks</div>';
            }
        }

        async function generateSmartTasks(includeCalendarDefault) {
            const includeEmail = document.getElementById('include-email')?.checked || false;
            try {
                const r = await fetch('/api/tasks/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ include_notes: true, include_calendar: includeCalendarDefault, include_email: includeEmail })
                });
                const d = await r.json();
                loadTasks();
            } catch (e) {
                console.error('Generate tasks error', e);
            }
        }

        function selectWeatherLocation(lat, lon, name) {
            try {
                localStorage.setItem('weather_selected', JSON.stringify({lat, lon, name}));
            } catch {}
            loadWeather(lat, lon, name);
        }

        function useCurrentLocation() {
            if (!navigator.geolocation) { return; }
            navigator.geolocation.getCurrentPosition(pos => {
                const { latitude, longitude } = pos.coords;
                loadWeather(latitude, longitude, 'Current Location');
            }, () => {
                // Fallback: load default
                loadWeather();
            });
        }

        // Calm Radar / Anxiety Feed
        async function loadAnxietyFeed() {
            const list = document.getElementById('anxiety-list');
            try {
                const resp = await fetch('/api/feeds/anxiety');
                const data = await resp.json();
                if (data.success && data.articles && data.articles.length > 0) {
                    list.innerHTML = data.articles.slice(0, 6).map(a => `
                        <div class="bg-gray-900 rounded border border-emerald-700 p-3">
                            <a href="${a.link}" target="_blank" class="text-emerald-300 hover:text-emerald-200 font-semibold text-sm line-clamp-2">${a.title}</a>
                            <div class="text-xs text-emerald-200/70 mt-1">${a.date || 'Calm signal'}</div>
                            <div class="flex gap-2 mt-2">
                                <button onclick="setAnxietyPref('${a.id}','like')" class="flex-1 px-2 py-1 bg-emerald-700 hover:bg-emerald-600 rounded text-xs">üëç</button>
                                <button onclick="setAnxietyPref('${a.id}','hide')" class="flex-1 px-2 py-1 bg-emerald-800 hover:bg-emerald-700 rounded text-xs">üëÄ</button>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (e) {
                console.error('Anxiety feed error:', e);
            }
        }
        // Jokes
        async function loadJokes() {
            const el = document.getElementById('jokes');
            if (!el) return;
            try {
                const r = await fetch('/api/joke');
                const d = await r.json();
                console.log('Joke loaded:', d.joke);
                if (d.joke) {
                    el.innerHTML = `<div class="text-sm text-gray-300">${d.joke}</div>`;
                }
            } catch (e) { console.error('Jokes error', e); }
        }

        // Quote
        async function loadQuote() {
            const el = document.getElementById('quote');
            if (!el) return;
            try {
                const r = await fetch('/api/quote');
                const d = await r.json();
                console.log('Quote loaded:', d.quote);
                if (d.quote) {
                    el.innerHTML = `<div class="text-sm text-gray-300 italic">"${d.quote}"</div>`;
                }
            } catch (e) { console.error('Quote error', e); }
        }

        // Comics: handled above; keep only the change listener here
        document.addEventListener('change', (ev) => {
            const t = ev.target;
            if (t && t.id === 'comic-select') reloadComic();
        });

        function setAnxietyPref(id, value) {
            const prefs = JSON.parse(localStorage.getItem('anxiety_prefs') || '{}');
            prefs[id] = value;
            localStorage.setItem('anxiety_prefs', JSON.stringify(prefs));
        }

        // Family Calendar from iCloud
        async function loadFamilyCalendar() {
            const display = document.getElementById('calendar-family');
            try {
                const resp = await fetch('/api/calendar/family');
                const data = await resp.json();
                if (data.success && data.events && data.events.length > 0) {
                    display.innerHTML = data.events.slice(0, 10).map(event => `
                        <div class="mb-3 pb-3 border-b border-blue-700 last:border-0">
                            <div class="font-semibold text-blue-300 text-sm">${event.title}</div>
                            <div class="text-xs text-gray-400">${event.start_time}</div>
                        </div>
                    `).join('');
                } else {
                    display.innerHTML = '<div class="text-gray-500 text-sm">No family events</div>';
                }
            } catch (e) {
                console.error('Family calendar error:', e);
                display.innerHTML = '<div class="text-gray-500 text-sm">Error loading calendar</div>';
            }
        }

        // Roger Home Content
        async function loadRogerHome() {
            try {
                const resp = await fetch('/api/roger_home');
                const data = await resp.json();
                console.log('Roger Home loaded:', data);
                if (!data.ok) return;
                const c = data.content || {};

                // Parts
                const partsEl = document.getElementById('parts');
                if (partsEl && c.parts_search_terms) {
                    partsEl.innerHTML = `
                        <div class="space-y-2">
                            ${c.parts_search_terms.slice(0, 3).map(t => `<div class="text-xs text-gray-300">üîç ${t}</div>`).join('')}
                            ${c.parts_tips ? `<div class="text-xs text-gray-400 mt-2">${c.parts_tips[0]}</div>` : ''}
                        </div>`;
                }

                // History
                const historyEl = document.getElementById('history');
                if (historyEl && c.history_fact) {
                    historyEl.innerHTML = `<div class="text-sm text-gray-300">${c.history_fact}</div>`;
                }

                // Star Wars
                const starwarsEl = document.getElementById('starwars');
                if (starwarsEl && c.starwars_fact) {
                    starwarsEl.innerHTML = `<div class="text-sm text-gray-300">${c.starwars_fact}</div>`;
                }

                // Communities
                const commEl = document.getElementById('communities');
                if (commEl && Array.isArray(c.subreddit_suggestions)) {
                    commEl.innerHTML = c.subreddit_suggestions.slice(0, 3).map(s => `
                        <div class="mb-2">
                            <a href="https://reddit.com/r/${s.subreddit}" target="_blank" class="text-purple-300 hover:underline text-sm">r/${s.subreddit}</a>
                            <div class="text-xs text-gray-500">${s.tip}</div>
                        </div>
                    `).join('');
                }

                // Roger Quotes
                const rogerQuotesEl = document.getElementById('roger-quotes');
                if (rogerQuotesEl && c.positive_quote) {
                    rogerQuotesEl.innerHTML = `<div class="text-sm text-gray-300 italic">"${c.positive_quote}"</div>`;
                }
            } catch (e) {
                console.error('Roger home error:', e);
            }
        }

        // Initialize data loaders
        function initializeDataLoaders() {
            console.log('üöÄ INITIALIZING DATA LOADERS');
            
            // Just call all the loaders
            loadJokes();
            loadQuote();
            loadRogerHome();
            reloadComic();
            loadEbayAuctions();
            loadWeather();
            loadAnxietyFeed();
            
            console.log('üöÄ ALL DATA LOADERS CALLED');
        }

        // Initialize when page loads
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            // Page is already loaded
            console.log('üìÑ Page already loaded, initializing now');
            setTimeout(initializeDataLoaders, 100);
        } else {
            // Wait for page to load
            console.log('üìÑ Waiting for page load...');
            window.addEventListener('load', () => {
                console.log('üìÑ Page loaded event fired, initializing...');
                setTimeout(initializeDataLoaders, 100);
            });
        }

    </script>
</body>
</html>
